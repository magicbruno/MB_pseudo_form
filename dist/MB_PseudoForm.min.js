!function(t,s){"use strict";class i{constructor(){this.list=[]}list=[];get length(){return this.list.length}item(e){return this.list[e]}add(e,t,s="",i="",l=""){var a=this.indexOf(e);return-1==a?this.list.push({Name:e,Value:t,Type:s,Label:i,Detail:l}):this.list[a]={Name:e,Value:t,Type:s,Label:i,Detail:l},-1===a}push(e){var t=this.indexOf(e.name);return-1==t?this.list.push(e):this.list[t]=e,this.length}remove(e){e=this.indexOf(e);return-1<e&&this.list.splice(e,1),-1<e}indexOf(e){for(var t=0;t<this.list.length;t++)if(this.list[t].Name===e)return t;return-1}getValue(e){e=this.indexOf(e);return-1<e?this.list[e].Value:null}clear(){this.list.splice(0,this.list.length)}}class h{constructor(e,t,s,i,l){this.initValues(e,t,s,i,l)}Name="";Value=null;Type="";Label="";Detail="";initValues(e,t,s="",i="",l=""){this.Name=e,this.Value=t,this.Type=s,this.Label=i,this.Detail=l}static createAsync(l){let a=l.name||l.id,n=l.type||"",r=l.tagName,o=l.ariaLabel||a,u=null,c="";return l.files&&0<l.files.length&&(c=l.files[0].name),"file"!=n&&(c=l.dataset.mbDetail||""),new Promise((t,s)=>{try{if("select"==r||"textarea"==r)u=l.value,"select-multiple"==n&&console.warn("Multiple selections are not supported! Only first selection will be processed."),t(new h(a,u,n,o,c));else switch(n){case"file":if(l.files)if(1<l.files.length&&console.warn("Multiple files input is not supported! Only first file selected will be processed."),0<l.files.length){var e=l.files[0];const i=new FileReader;i.onloadend=()=>{var e=i.result;t(new h(a,e,n,o,c))},i.readAsDataURL(e)}else t(new h(a,u,n,o,c));break;case"radio":l.checked&&(u=l.value),t(new h(a,u,n,o,c));break;case"checkbox":u=l.checked,t(new h(a,u,n,o,c));break;case"submit":case"button":case"image":case"reset":t(new h(a,null,n,o,c));break;default:u=l.value,t(new h(a,u,n,o,c))}}catch(e){s(e)}})}}class l{constructor(e,t){this.init(e,t)}form=null;_submit=null;pendingChanges=!1;endPoint="";values=null;get inputs(){return this.form.querySelectorAll("input, select, textarea")}get pseudoForm(){return this.form}get submit(){return this._submit}init(e){const t=this;if("string"==typeof e)this.form=s.querySelector(e);else{if("object"!=typeof e||!e.tagName)throw"MB_PseudoForm error: You must provide a selector or a HTML element as parameter!";this.form=e}if(this._submit=this.form.querySelector('[data-mb-toggle="submit"]'),!this.submit)throw'MB_PseudoForm error: You must include a submit button (an element with data-mb-toggle="submit")!';this.submit.addEventListener("click",()=>{t.submitData()}),this.values=new i,this.endPoint=this.form.dataset.mbAction,this.inputs.forEach(e=>{e.addEventListener("change",e=>{t.pendingChanges=!0;e=new CustomEvent("change.mb.pseudoform",{detail:e.target});t.form.dispatchEvent(e)})})}submitData(){const s=this;this.collectData().then(e=>{var t=new CustomEvent("validate.mb.pseudoform",{cancelable:!0,detail:e});this.form.dispatchEvent(t)&&((t=new Headers).append("Content-Type","application/json"),e=JSON.stringify(e.list),fetch(this.endPoint,{method:"POST",headers:t,body:e,redirect:"follow"}).then(e=>e.json()).then(e=>{e=new CustomEvent("submitted.mb.pseudoform",{detail:e});s.form.dispatchEvent(e),s.pendingChanges=!1}).catch(e=>{e=new CustomEvent("submitted.mb.pseudoform",{detail:{Success:!1,Message:e,Exitcode:-1,Data:null}});s.form.dispatchEvent(e)}))}).catch(e=>console.error(e))}collectData(){this.values.clear();const i=this;return new Promise((t,s)=>{this._collect().then(e=>{e.forEach(e=>{null!==e.Value&&i.values.push(e)}),t(i.values)}).catch(e=>s(e))})}_collect(){const i=[];return this.inputs.forEach(e=>{i.push(h.createAsync(e))}),new Promise((t,s)=>{Promise.all(i).then(e=>t(e)).catch(e=>s(e))})}}t.MB_PseudoForm=l,t.pseudoForms=[],s.addEventListener("DOMContentLoaded",()=>{const e=s.querySelectorAll('[data-mb-ride="pseudo-form"]');e.forEach(e=>{try{t.pseudoForms.push(new l(e))}catch(e){console.error("Can't create MB_PseudoForm: "+e)}})})}(window,document);